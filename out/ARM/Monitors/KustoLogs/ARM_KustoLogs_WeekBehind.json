{
  "bv": 10,
  "component": "KustoLogs",
  "computedMetrics": null,
  "deleted": false,
  "description": null,
  "dimensions": null,
  "displayName": null,
  "enableClientEtwPublication": true,
  "enableClientSideForking": true,
  "enableClientSideLastSamplingMode": false,
  "enableClientSidePublication": true,
  "id": "WeekBehind",
  "isFromNewPipeline": false,
  "isQosMetric": false,
  "metrics": null,
  "monitors": [
    {
      "category": "",
      "conditions": [
        [
          "Component",
          "*",
          "Storage Replicator (SOSR),Providers (PRDS)"
        ],
        [
          "Region",
          "*",
          ""
        ],
        [
          "BuildVersion",
          "*",
          ""
        ],
        [
          "ReleaseWeek",
          "*",
          "*-ex*,*-rx*,*-lx*",
          "w"
        ]
      ],
      "customLinks": [
        {
          "$type": "Microsoft.Online.Metrics.Common.EventConfiguration.KustoJarvisLink, Microsoft.Online.Metrics.Common",
          "autoExecute": true,
          "compressQuery": true,
          "database": "ARMProd",
          "endpoint": "https://armprod.kusto.windows.net",
          "executionDelay": "00:01:00",
          "maxResultRowCount": 176,
          "preIncidentQueryTimeout": "00:00:50",
          "query": "Service \n| where TaskName == \"ServiceStarted\"\n| order by Role, RoleInstance asc, TIMESTAMP asc, [\"version\"]\n| extend Component = case(Role == \"Providers.Shim.razzle\", \"PRDS\",   Role == \"Providers.AppliancePublisher.razzle\", \"PRDS\",   Role == \"Providers.Authorization.razzle\", \"PRDS\",   Role == \"Providers.Feature.razzle\", \"PRDS\",   Role == \"Providers.Test.razzle\", \"PRDS\",   Role == \"Providers.Worker.razzle\", \"PRDS\",  Role == \"Frontdoor.Worker.razzle\", \"FDW\",  Role == \"Frontdoor.Web.razzle\", \"FD\",  Role == \"Frontdoor.Admin.razzle\", \"FD\",  Role == \"StorageOperations.Operator.razzle\", \"SOSO\",  Role == \"StorageOperations.Replicator.Partner.razzle\", \"SOSR\",  Role == \"StorageOperations.Replicator.Platform.razzle\", \"SOSR\",  \"\")\n| summarize max(TIMESTAMP) by Component, SourceNamespace\n| join\n(\n    Service\n    | where TaskName == \"ServiceStarted\"\n    | order by Role, RoleInstance asc, TIMESTAMP asc, [\"version\"]\n    | extend Week = extract(\"2018w.[^(]+\", 0, ['version'])\n    | extend IntWeek = extract(\"w.[^(]+\", 0, ['version'])\n    | extend ReleaseWeek = toint(substring(IntWeek, 1, 2))\n    | extend DeploymentTime = format_datetime(TIMESTAMP, \"M/d/yy HH:mm\") \n    | extend Region = extract(\"csm(.*)(SOS|RPF|PRDS)\", 1, SourceNamespace)\n    | extend Component = case(Role == \"Providers.Shim.razzle\", \"PRDS\",   Role == \"Providers.AppliancePublisher.razzle\", \"PRDS\",   Role == \"Providers.Authorization.razzle\", \"PRDS\",   Role == \"Providers.Feature.razzle\", \"PRDS\",   Role == \"Providers.Test.razzle\", \"PRDS\",   Role == \"Providers.Worker.razzle\", \"PRDS\",  Role == \"Frontdoor.Worker.razzle\", \"FDW\",  Role == \"Frontdoor.Web.razzle\", \"FD\",  Role == \"Frontdoor.Admin.razzle\", \"FD\",  Role == \"StorageOperations.Operator.razzle\", \"SOSO\",  Role == \"StorageOperations.Replicator.Partner.razzle\", \"SOSR\",  Role == \"StorageOperations.Replicator.Platform.razzle\", \"SOSR\",  \"\")\n)\non Component and SourceNamespace and $left.max_TIMESTAMP == $right.TIMESTAMP\n| extend CurrentWeek = toint(weekofyear(now()))\n| extend WeekBehind = CurrentWeek - ReleaseWeek \n| extend SourceRole = strcat(Component, \".\", Region)\n| distinct PreciseTimeStamp, SourceRole, WeekBehind, CurrentWeek, ReleaseWeek \n| project PreciseTimeStamp, d_SourceNamespace = SourceRole, m_WeekBehind = WeekBehind\n| where m_WeekBehind >= 3\n",
          "title": "ARM deployments that are more than 2 weeks behind",
          "type": "Kusto"
        }
      ],
      "customMessage": "Please run this query from Kusto Explorer: Service  | where TaskName == \"ServiceStarted\" | order by Role, RoleInstance asc, TIMESTAMP asc, [\"version\"] | extend Component = case(Role == \"Providers.Shim.razzle\", \"PRDS\",   Role == \"Providers.AppliancePublisher.razzle\", \"PRDS\",   Role == \"Providers.Authorization.razzle\", \"PRDS\",   Role == \"Providers.Feature.razzle\", \"PRDS\",   Role == \"Providers.Test.razzle\", \"PRDS\",   Role == \"Providers.Worker.razzle\", \"PRDS\",  Role == \"Frontdoor.Worker.razzle\", \"FDW\",  Role == \"Frontdoor.Web.razzle\", \"FD\",  Role == \"Frontdoor.Admin.razzle\", \"FD\",  Role == \"StorageOperations.Operator.razzle\", \"SOSO\",  Role == \"StorageOperations.Replicator.Partner.razzle\", \"SOSR\",  Role == \"StorageOperations.Replicator.Platform.razzle\", \"SOSR\",  \"\") | summarize max(TIMESTAMP) by Component, SourceNamespace | join (     Service     | where TaskName == \"ServiceStarted\"     | order by Role, RoleInstance asc, TIMESTAMP asc, [\"version\"]     | extend Week = extract(\"2018w.[^(]+\", 0, ['version'])     | extend IntWeek = extract(\"w.[^(]+\", 0, ['version'])     | extend ReleaseWeek = toint(substring(IntWeek, 1, 2))     | extend DeploymentTime = format_datetime(TIMESTAMP, \"M/d/yy HH:mm\")      | extend Region = extract(\"csm(.*)(SOS|RPF|PRDS)\", 1, SourceNamespace)     | extend Component = case(Role == \"Providers.Shim.razzle\", \"PRDS\",   Role == \"Providers.AppliancePublisher.razzle\", \"PRDS\",   Role == \"Providers.Authorization.razzle\", \"PRDS\",   Role == \"Providers.Feature.razzle\", \"PRDS\",   Role == \"Providers.Test.razzle\", \"PRDS\",   Role == \"Providers.Worker.razzle\", \"PRDS\",  Role == \"Frontdoor.Worker.razzle\", \"FDW\",  Role == \"Frontdoor.Web.razzle\", \"FD\",  Role == \"Frontdoor.Admin.razzle\", \"FD\",  Role == \"StorageOperations.Operator.razzle\", \"SOSO\",  Role == \"StorageOperations.Replicator.Partner.razzle\", \"SOSR\",  Role == \"StorageOperations.Replicator.Platform.razzle\", \"SOSR\",  \"\") ) on Component and SourceNamespace and $left.max_TIMESTAMP == $right.TIMESTAMP | extend CurrentWeek = toint(weekofyear(now())) | extend WeekBehind = CurrentWeek - ReleaseWeek  | extend SourceRole = strcat(Component, \".\", Region) | distinct PreciseTimeStamp, Region, SourceRole, WeekBehind, CurrentWeek, ReleaseWeek  | where WeekBehind >= 3",
      "customTitle": "ARM deployment for [{monitor.Dimension.Component}] on [{monitor.Dimension.Region}] is more than 2 weeks behind with release [{monitor.Dimension.ReleaseWeek}]  and build [{monitor.Dimension.BuildVersion}] ",
      "dashboardName": "",
      "dashboardNamespace": "",
      "description": "This monitor is to alert when ARM component (FD, FDW, PRDS, SOSO, SOSR) deployments in any region is more than 2 weeks behind.",
      "desiredConditions": null,
      "eventIdentifier": {
        "component": "KustoLogs",
        "id": "WeekBehind",
        "tenant": "ARM"
      },
      "explicitPreAgg": null,
      "frequency": "00:30:00",
      "healthyCountToMitigateIncident": 3,
      "healthyDurationToMitigateIncident": "01:00:00",
      "hintsLookbackDuration": "1.00:00:00",
      "id": "ARMComponentDeployment",
      "ingestionDelay": "00:00:00",
      "inputResourceType": "",
      "isDisabled": false,
      "isRegularMonitor": true,
      "isSilent": false,
      "isThrottled": false,
      "lastUpdatedBy": "joraki",
      "lastUpdateTime": "2019-11-05T23:38:34.8474302Z",
      "lookbackDuration": "01:00:00",
      "metadata": [
        {
          "metadataKey": "Icm.OccurringLocation.DataCenter",
          "metadataValue": "{\"DimensionName\":\"CloudInfo\",\"DimensionValuestoSiloIdMap\":{\"prod\":1,\"mc\":3,\"ff\":5,\"bf\":8},\"DefaultSiloId\":1}"
        }
      ],
      "metricsViewName": "",
      "monitorActorConfiguration": {
        "additionalDataForMonitorsEnabled": false,
        "azureCacheTimeToExclude": "00:00:00",
        "baselineConcurrentGetAnomalyCallsV2": 0,
        "baselineFastServiceUri": null,
        "baselineFastServiceUriForAzure": null,
        "baselineIsAnomalyBatchProcessingSize": 0,
        "baselineServiceUri": null,
        "baselineServiceUriForAzure": null,
        "baselineServiceUseQueryService": false,
        "baselineUiFacingServiceUri": null,
        "baselineUiFacingServiceUriForAzure": null,
        "baseReportExpirationTimeInSeconds": 0,
        "batchReportingMonitor": false,
        "cacheTimeToExclude": "00:00:00",
        "cadMaxCombinationsEvaluationThreshold": 0,
        "certificateIdentifier": null,
        "certificateThumbprint": null,
        "combinationDeltaFetchLookback": "00:00:00",
        "combinationRefreshMinInterval": "00:00:00",
        "combinationsChunkSizePerConcurrentEvaluateBlock": 0,
        "consecutiveMonitorTimeoutsForAlerting": 0,
        "customizeSeverityForMonitorExecutionFailure": false,
        "debug": false,
        "disabled": false,
        "disableMetricDataInAlerts": false,
        "dqConcurrencyConfiguration": null,
        "dynamicThresholdMaxCombinationsEvaluationThreshold": 0,
        "enableCombinationsThrottlingForCad": false,
        "enableCostReporting": false,
        "enableDictionaryBasedMetricsSourceMatching": false,
        "enableGroupingByCommonDimensions": false,
        "enableHealthMonitors": false,
        "enableMonitorTimeoutAlerts": false,
        "enableQueryServiceQosMetricSupport": false,
        "enableSelectPreaggregate": false,
        "enableSubmitMetricsFromJs": false,
        "evaluatorTimeout": "00:00:00",
        "fetchDeltaHints": false,
        "hasUserConfigCacheTimeToExclude": null,
        "hintLookbackDuration": "00:00:00",
        "includeTimeSeriesInformationInWatchdogMetadata": false,
        "isThirdPartyStamp": false,
        "kenshoServiceUri": null,
        "logCombinationsInfo": false,
        "maxBufferSizeForRetrievedData": 0,
        "maxCombinationsCountPerPartition": 0,
        "maxCombinationsEvaluationThreshold": 0,
        "maxCombinationsForDataSources": 0,
        "maxCombinationsForMetricSources": 0,
        "maxConcurrentRetrieveOperations": 0,
        "maxDegreeOfParallelismForEvaluateBlock": 0,
        "maxFetchMetricsInJs": 0,
        "minCombinationsCountToRequirePartition": 0,
        "notQueryMetricsSourceCombinationIfNoWildcard": false,
        "overrideHealthDataValidation": false,
        "overrideMetricDataValidation": false,
        "partnerClientCertificateIdentifier": null,
        "preferMetricsStore": false,
        "preventCombinationsOverwriteByDeltaRefresh": false,
        "previewWithHistoricData": false,
        "removeExtraIngestionDelayInExecution": false,
        "removeExtraQueryComparison": false,
        "resourceTypeOverride": null,
        "treatInheritNotAsWildcard": false,
        "useAccountMigrationSupport": false,
        "useDefaultAzureMonitorLatency": false,
        "useHealthService": false,
        "useInternalHintingApi": false,
        "useLatestQueryRequestSerializationVersion": false,
        "useLowLatencyPipelineDataQualityForAzureMonitor": false,
        "useMetricsStoreMigrationSupport": false,
        "useNewHintingApi": false,
        "useNewMonitorTemplateInterface": false,
        "useNewMonitorTemplateInterfaceForDynamicThreshold": false,
        "useOptimizedMetricFetch": false,
        "useQueryServiceBatching": false,
        "useQueryServiceBatchingForJs": false,
        "useQueryServiceForCrossStampQuery": false,
        "useQueryServiceInMdmDataQualityClient": false,
        "useResolutionForAnomalyTimeWindowLookback": false,
        "zeroAsNoValueSentinel": false
      },
      "monitorDataSourceType": 0,
      "raiseIncientOnMonitorFailure": null,
      "resourceType": "ARMComponentDeployments",
      "severityForMonitorFailure": 0,
      "shouldMitigateIncident": true,
      "shouldSendToAutomation": false,
      "templateSpecificParameters": {
        "alertOnDivideByZeroError": "false",
        "denominator": "Count",
        "numerator": "Average"
      },
      "templateType": 3,
      "tenantName": "",
      "thresholds": [
        {
          "comparator": ">=",
          "healthStatus": 1,
          "severity": 3,
          "value": 3.0
        }
      ],
      "version": 39
    }
  ],
  "pendingMetricsOrderingFix": false,
  "preferQueryMetricsStore": null,
  "replicationState": 0,
  "tenant": "ARM",
  "treatMissingSeriesAsZeros": false,
  "version": 0,
  "views": null
}