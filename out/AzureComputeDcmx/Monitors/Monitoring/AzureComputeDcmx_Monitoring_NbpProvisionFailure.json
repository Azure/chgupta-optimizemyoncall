{
  "bv": 10,
  "component": "Monitoring",
  "computedMetrics": null,
  "deleted": false,
  "description": null,
  "dimensions": null,
  "displayName": null,
  "enableClientEtwPublication": true,
  "enableClientSideForking": true,
  "enableClientSideLastSamplingMode": false,
  "enableClientSidePublication": true,
  "id": "NbpProvisionFailure",
  "isFromNewPipeline": false,
  "isQosMetric": false,
  "metrics": null,
  "monitors": [
    {
      "category": "DriveEncryption",
      "conditions": [
        [
          "AzureCluster",
          "*",
          ""
        ],
        [
          "FailureReason",
          "Unknown",
          ""
        ]
      ],
      "customLinks": [],
      "customMessage": "The NBP Workflow Worker(AgentBitlockerOperation) has been conistently failing for a blade for the past 8 hours",
      "customTitle": "AzureBootProtector Provision Failure on Blade {Monitor.Dimension.ResourceId}",
      "dashboardName": "",
      "dashboardNamespace": "",
      "description": "",
      "desiredConditions": null,
      "eventIdentifier": {
        "component": "Monitoring",
        "id": "NbpProvisionFailure",
        "tenant": "AzureComputeDcmx"
      },
      "explicitPreAgg": null,
      "frequency": "00:03:00",
      "healthyCountToMitigateIncident": 10,
      "healthyDurationToMitigateIncident": "00:27:00",
      "hintsLookbackDuration": "1.00:00:00",
      "id": "NbpProvisionFailure_2",
      "ingestionDelay": "00:00:00",
      "inputResourceType": "",
      "isDisabled": true,
      "isRegularMonitor": true,
      "isSilent": false,
      "isThrottled": false,
      "lastUpdatedBy": "HAICZHU",
      "lastUpdateTime": "2020-07-07T23:27:27.3659982Z",
      "lookbackDuration": "00:05:00",
      "metadata": [
        {
          "metadataKey": "RoutingId",
          "metadataValue": "MDM://AzureHardware/DatacenterManagerPilot"
        }
      ],
      "metricsViewName": "",
      "monitorActorConfiguration": {
        "additionalDataForMonitorsEnabled": false,
        "azureCacheTimeToExclude": "00:00:00",
        "baselineConcurrentGetAnomalyCallsV2": 0,
        "baselineFastServiceUri": null,
        "baselineFastServiceUriForAzure": null,
        "baselineIsAnomalyBatchProcessingSize": 0,
        "baselineServiceUri": null,
        "baselineServiceUriForAzure": null,
        "baselineServiceUseQueryService": false,
        "baselineUiFacingServiceUri": null,
        "baselineUiFacingServiceUriForAzure": null,
        "baseReportExpirationTimeInSeconds": 0,
        "batchReportingMonitor": false,
        "cacheTimeToExclude": "00:00:00",
        "cadMaxCombinationsEvaluationThreshold": 0,
        "certificateIdentifier": null,
        "certificateThumbprint": null,
        "combinationDeltaFetchLookback": "00:00:00",
        "combinationRefreshMinInterval": "00:00:00",
        "combinationsChunkSizePerConcurrentEvaluateBlock": 0,
        "consecutiveMonitorTimeoutsForAlerting": 0,
        "customizeSeverityForMonitorExecutionFailure": false,
        "debug": false,
        "disabled": false,
        "disableMetricDataInAlerts": false,
        "dqConcurrencyConfiguration": null,
        "dynamicThresholdMaxCombinationsEvaluationThreshold": 0,
        "enableCombinationsThrottlingForCad": false,
        "enableCostReporting": false,
        "enableDictionaryBasedMetricsSourceMatching": false,
        "enableGroupingByCommonDimensions": false,
        "enableHealthMonitors": false,
        "enableMonitorTimeoutAlerts": false,
        "enableQueryServiceQosMetricSupport": false,
        "enableSelectPreaggregate": false,
        "enableSubmitMetricsFromJs": false,
        "evaluatorTimeout": "00:00:00",
        "fetchDeltaHints": false,
        "hasUserConfigCacheTimeToExclude": null,
        "hintLookbackDuration": "00:00:00",
        "includeTimeSeriesInformationInWatchdogMetadata": false,
        "isThirdPartyStamp": false,
        "kenshoServiceUri": null,
        "logCombinationsInfo": false,
        "maxBufferSizeForRetrievedData": 0,
        "maxCombinationsCountPerPartition": 0,
        "maxCombinationsEvaluationThreshold": 0,
        "maxCombinationsForDataSources": 0,
        "maxCombinationsForMetricSources": 0,
        "maxConcurrentRetrieveOperations": 0,
        "maxDegreeOfParallelismForEvaluateBlock": 0,
        "maxFetchMetricsInJs": 0,
        "minCombinationsCountToRequirePartition": 0,
        "notQueryMetricsSourceCombinationIfNoWildcard": false,
        "overrideHealthDataValidation": false,
        "overrideMetricDataValidation": false,
        "partnerClientCertificateIdentifier": null,
        "preferMetricsStore": false,
        "preventCombinationsOverwriteByDeltaRefresh": false,
        "previewWithHistoricData": false,
        "removeExtraIngestionDelayInExecution": false,
        "removeExtraQueryComparison": false,
        "resourceTypeOverride": null,
        "treatInheritNotAsWildcard": false,
        "useAccountMigrationSupport": false,
        "useDefaultAzureMonitorLatency": false,
        "useHealthService": false,
        "useInternalHintingApi": false,
        "useLatestQueryRequestSerializationVersion": false,
        "useLowLatencyPipelineDataQualityForAzureMonitor": false,
        "useMetricsStoreMigrationSupport": false,
        "useNewHintingApi": false,
        "useNewMonitorTemplateInterface": false,
        "useNewMonitorTemplateInterfaceForDynamicThreshold": false,
        "useOptimizedMetricFetch": false,
        "useQueryServiceBatching": false,
        "useQueryServiceBatchingForJs": false,
        "useQueryServiceForCrossStampQuery": false,
        "useQueryServiceInMdmDataQualityClient": false,
        "useResolutionForAnomalyTimeWindowLookback": false,
        "zeroAsNoValueSentinel": false
      },
      "monitorDataSourceType": 0,
      "raiseIncientOnMonitorFailure": null,
      "resourceType": "Cluster",
      "severityForMonitorFailure": 0,
      "shouldMitigateIncident": false,
      "shouldSendToAutomation": false,
      "templateSpecificParameters": {
        "metric": "Count"
      },
      "templateType": 2,
      "tenantName": "",
      "thresholds": [
        {
          "comparator": ">=",
          "healthStatus": 1,
          "severity": 4,
          "value": 1.0
        }
      ],
      "version": 4
    },
    {
      "category": "DriveEncryption",
      "conditions": [
        [
          "AzureCluster",
          "*",
          ""
        ],
        [
          "FailureReason",
          "ERROR_NO_SYSTEM_RESOURCES",
          ""
        ]
      ],
      "customLinks": [
        {
          "$type": "Microsoft.Online.Metrics.Common.EventConfiguration.KustoJarvisLink, Microsoft.Online.Metrics.Common",
          "autoExecute": true,
          "compressQuery": true,
          "database": "AzureDCMDb",
          "endpoint": "https://azuredcm.kusto.windows.net",
          "executionDelay": "00:01:00",
          "maxResultRowCount": 50,
          "preIncidentQueryTimeout": "00:00:50",
          "query": " (cluster(\"azuredcm\").database(\"AzureDCMDb\").RdmResourceSnapshot\n                    | where PreciseTimeStamp > ago(4h) and DeviceType==\"Blade\"\n                    | summarize arg_max(PreciseTimeStamp, *) by AzureCluster, ResourceId \n                    | where OSType==\"FullOS\" and LifecycleState == \"Production\" and (now() - LifecycleStateChangeTime) > 12h\n                    | project AzureCluster=tolower(AzureCluster), ResourceId) \n| join kind=inner (cluster(\"azurecm\").database(\"AzureCM\").DCMWOSWorkflowResultEtwTable\n                    | where PreciseTimeStamp > ago(8h) and \n                      WorkflowType == \"Microsoft.Windows.Azure.Fabric.DataCenterFabric.AgentWorkers.AgentBitlockerOperation\"\n                    | summarize FailCount=countif(ResultType==\"Failed\"), Total=count() by Tenant, ResourceId \n                    | where FailCount == Total and FailCount > 6\n                    | project AzureCluster=tolower(Tenant), ResourceId, FailCount) on AzureCluster, ResourceId \n| join kind=inner (cluster(\"azurecm\").database(\"AzureCM\").DCMWOSWorkflowResultEtwTable\n                        | where PreciseTimeStamp > ago(8h) and\n                          WorkflowType == \"Microsoft.Windows.Azure.Fabric.DataCenterFabric.AgentWorkers.AgentBitlockerOperation\" and \n                          ResultType == \"Failed\"\n                        | project PreciseTimeStamp, AzureCluster=tolower(Tenant), ResourceId, Failure=Result) on AzureCluster, ResourceId \n| project-away AzureCluster1, ResourceId1\n| extend //FailureCountBucket=Bucketize(FailCount, 25, 100, \" Attempt(s)\", \"100+ Attempts\"),\n         FailureReason=case(Failure contains \"2147943850\" or Failure contains \"800705aa\", \"ERROR_NO_SYSTEM_RESOURCES\",\n                            Failure contains \"no endpoint listening\", \"AgentNotUp\",\n                            Failure contains \"2147500034\", \"E_NOINTERFACE\",\n                            Failure contains \"service shutting down\", \"PossibleAgentCrash\",\n                            Failure contains \"SendTimeout value on the Binding\", \"Timeout\", \n                            Failure contains \"System.Collections.ArrayList.ArrayListEnumeratorSimple.MoveNext\", \"WCFBug\",\n                            Failure contains \"2147944205\", \"ERROR_INVALID_ENVIRONMENT\", \"Unknown\")           \n| where FailureReason == \"ERROR_NO_SYSTEM_RESOURCES\" and AzureCluster contains \"{Monitor.Dimension.AzureCluster}\"\n| summarize arg_max(FailCount,*) by ResourceId \n",
          "title": "Impacted blades",
          "type": "Kusto"
        }
      ],
      "customMessage": "The NBP Workflow Worker(AgentBitlockerOperation) has been conistently failing for a blade for the past 8 hours",
      "customTitle": "NBP Provision Failure(Low System Resource) on Cluster {Monitor.Dimension.AzureCluster}",
      "dashboardName": "",
      "dashboardNamespace": "",
      "description": "",
      "desiredConditions": null,
      "eventIdentifier": {
        "component": "Monitoring",
        "id": "NbpProvisionFailure",
        "tenant": "AzureComputeDcmx"
      },
      "explicitPreAgg": null,
      "frequency": "00:03:00",
      "healthyCountToMitigateIncident": 10,
      "healthyDurationToMitigateIncident": "00:27:00",
      "hintsLookbackDuration": "1.00:00:00",
      "id": "NbpProvisionFailure",
      "ingestionDelay": "00:00:00",
      "inputResourceType": "",
      "isDisabled": true,
      "isRegularMonitor": true,
      "isSilent": false,
      "isThrottled": false,
      "lastUpdatedBy": "haiczhu",
      "lastUpdateTime": "2020-07-08T22:20:47.4515994Z",
      "lookbackDuration": "00:05:00",
      "metadata": [
        {
          "metadataKey": "RoutingId",
          "metadataValue": "MDM://AzureHardware/DatacenterManagerPilot"
        }
      ],
      "metricsViewName": "",
      "monitorActorConfiguration": {
        "additionalDataForMonitorsEnabled": false,
        "azureCacheTimeToExclude": "00:00:00",
        "baselineConcurrentGetAnomalyCallsV2": 0,
        "baselineFastServiceUri": null,
        "baselineFastServiceUriForAzure": null,
        "baselineIsAnomalyBatchProcessingSize": 0,
        "baselineServiceUri": null,
        "baselineServiceUriForAzure": null,
        "baselineServiceUseQueryService": false,
        "baselineUiFacingServiceUri": null,
        "baselineUiFacingServiceUriForAzure": null,
        "baseReportExpirationTimeInSeconds": 0,
        "batchReportingMonitor": false,
        "cacheTimeToExclude": "00:00:00",
        "cadMaxCombinationsEvaluationThreshold": 0,
        "certificateIdentifier": null,
        "certificateThumbprint": null,
        "combinationDeltaFetchLookback": "00:00:00",
        "combinationRefreshMinInterval": "00:00:00",
        "combinationsChunkSizePerConcurrentEvaluateBlock": 0,
        "consecutiveMonitorTimeoutsForAlerting": 0,
        "customizeSeverityForMonitorExecutionFailure": false,
        "debug": false,
        "disabled": false,
        "disableMetricDataInAlerts": false,
        "dqConcurrencyConfiguration": null,
        "dynamicThresholdMaxCombinationsEvaluationThreshold": 0,
        "enableCombinationsThrottlingForCad": false,
        "enableCostReporting": false,
        "enableDictionaryBasedMetricsSourceMatching": false,
        "enableGroupingByCommonDimensions": false,
        "enableHealthMonitors": false,
        "enableMonitorTimeoutAlerts": false,
        "enableQueryServiceQosMetricSupport": false,
        "enableSelectPreaggregate": false,
        "enableSubmitMetricsFromJs": false,
        "evaluatorTimeout": "00:00:00",
        "fetchDeltaHints": false,
        "hasUserConfigCacheTimeToExclude": null,
        "hintLookbackDuration": "00:00:00",
        "includeTimeSeriesInformationInWatchdogMetadata": false,
        "isThirdPartyStamp": false,
        "kenshoServiceUri": null,
        "logCombinationsInfo": false,
        "maxBufferSizeForRetrievedData": 0,
        "maxCombinationsCountPerPartition": 0,
        "maxCombinationsEvaluationThreshold": 0,
        "maxCombinationsForDataSources": 0,
        "maxCombinationsForMetricSources": 0,
        "maxConcurrentRetrieveOperations": 0,
        "maxDegreeOfParallelismForEvaluateBlock": 0,
        "maxFetchMetricsInJs": 0,
        "minCombinationsCountToRequirePartition": 0,
        "notQueryMetricsSourceCombinationIfNoWildcard": false,
        "overrideHealthDataValidation": false,
        "overrideMetricDataValidation": false,
        "partnerClientCertificateIdentifier": null,
        "preferMetricsStore": false,
        "preventCombinationsOverwriteByDeltaRefresh": false,
        "previewWithHistoricData": false,
        "removeExtraIngestionDelayInExecution": false,
        "removeExtraQueryComparison": false,
        "resourceTypeOverride": null,
        "treatInheritNotAsWildcard": false,
        "useAccountMigrationSupport": false,
        "useDefaultAzureMonitorLatency": false,
        "useHealthService": false,
        "useInternalHintingApi": false,
        "useLatestQueryRequestSerializationVersion": false,
        "useLowLatencyPipelineDataQualityForAzureMonitor": false,
        "useMetricsStoreMigrationSupport": false,
        "useNewHintingApi": false,
        "useNewMonitorTemplateInterface": false,
        "useNewMonitorTemplateInterfaceForDynamicThreshold": false,
        "useOptimizedMetricFetch": false,
        "useQueryServiceBatching": false,
        "useQueryServiceBatchingForJs": false,
        "useQueryServiceForCrossStampQuery": false,
        "useQueryServiceInMdmDataQualityClient": false,
        "useResolutionForAnomalyTimeWindowLookback": false,
        "zeroAsNoValueSentinel": false
      },
      "monitorDataSourceType": 0,
      "raiseIncientOnMonitorFailure": null,
      "resourceType": "ProvisionCluster",
      "severityForMonitorFailure": 0,
      "shouldMitigateIncident": false,
      "shouldSendToAutomation": false,
      "templateSpecificParameters": {
        "metric": "Count"
      },
      "templateType": 2,
      "tenantName": "",
      "thresholds": [
        {
          "comparator": ">=",
          "healthStatus": 1,
          "severity": 4,
          "value": 1.0
        }
      ],
      "version": 19
    }
  ],
  "pendingMetricsOrderingFix": false,
  "preferQueryMetricsStore": null,
  "replicationState": 0,
  "tenant": "AzureComputeDcmx",
  "treatMissingSeriesAsZeros": false,
  "version": 0,
  "views": null
}